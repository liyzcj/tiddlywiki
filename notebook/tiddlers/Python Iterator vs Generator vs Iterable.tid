caption: è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨ Iterator vs Generator
created: 20200315025558590
modified: 20200404125642061
tags: [[Python é«˜çº§åº”ç”¨]]
title: Python Iterator vs Generator vs Iterable
type: text/vnd.tiddlywiki

å…³äºè¿­ä»£ Iterationï¼Œåœ¨ Python ä¸­æœ‰ä¸‰ä¸ªé‡è¦çš„æ¦‚å¿µï¼š''Iterable''ï¼Œ''Iterator'' å’Œ ''Generator''ã€‚å¯¹äºåˆå­¦è€…ï¼Œè¿™ä¸‰ä¸ªæ¦‚å¿µç»å¸¸è¢«æ··æ·†ã€‚

!! Iterable

é¦–å…ˆ Iterable æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåªè¦ä¸€ä¸ªå¯¹è±¡æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªè¦æ±‚''ä¹‹ä¸€''ï¼Œå°±ç§°ä¹‹ä¸º Iterableï¼š

* æ‹¥æœ‰ `__iter__()` æ–¹æ³•ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª ''Iterator''ã€‚
* æ‹¥æœ‰ `__getitem__()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥æ ¹æ®ç»™å®šçš„ä» 0 å¼€å§‹çš„åºåˆ—è¿”å›ç»“æœï¼Œå¹¶ä¸”åœ¨ç´¢å¼•èŒƒå›´å¤–æŠ›å‡ºä¸€ä¸ª `IndexError` ã€‚ä¾‹å¦‚ä¸€ä¸ª Listã€‚

> `[]` ä»…ä»…æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå½“ä½ åœ¨ä»£ç ä¸­å†™ `obj[i]` æ—¶ï¼Œè¿™ä¼šè°ƒç”¨ obj çš„ `__getitem__()` æ–¹æ³•ã€‚

ä¸€ä¸ª Iterable å¯¹è±¡æœ¬èº«åº”è¯¥åŒ…å«æ‰€æœ‰è¢«éå†å‡ºçš„å…ƒç´ ã€‚

!! Iterator

Iterator ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡éœ€è¦''åŒæ—¶''æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š


* æ‹¥æœ‰ `__next__()` æ–¹æ³•ï¼Œå½“è¿­ä»£ç»“æŸæ—¶æŠ›å‡º `StopIteration` å¼‚å¸¸ã€‚
* æ‹¥æœ‰ `__iter__()` æ–¹æ³•ï¼Œè¿”å› `self`ã€‚

å½“ä½ ä½¿ç”¨ `next(obj)` æ—¶ï¼Œä¼šè°ƒç”¨å¯¹è±¡çš„ `__next__()` æ–¹æ³•ã€‚

> å½“ä½ ä½¿ç”¨ `for` å¾ªç¯ï¼Œ`map` ç­‰è¯­æ³•æ—¶ï¼ŒPython åœ¨å†…éƒ¨è‡ªåŠ¨è°ƒç”¨ `next()` æ–¹æ³•ã€‚ç”¨æ¥éå†ä¸€ä¸ª Iteratorã€‚

ä¸€ä¸ª Iterator å°±åƒä¸€ä¸ªä¹¦ç­¾ï¼Œå®ƒæ„ä¹‰åœ¨äºä¿å­˜äº†å½“å‰''éå†çš„ä½ç½®ã€‚'' 

''ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡åªèƒ½å‰è¿›ä¸èƒ½åé€€ï¼Œå¹¶ä¸”åªèƒ½è¿­ä»£ä¸€æ¬¡ã€‚''

!! Generator

Generator ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ Iteratorï¼Œæ˜¯ Python å†…ç½®çš„è¿­ä»£å™¨ã€‚

è¦ç¼–å†™ä¸€ä¸ª Generator éå¸¸ç®€å•ï¼Œåªéœ€è¦å®šä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”åœ¨å‡½æ•°å†…''ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª `yield` è¯­å¥''å³å¯ã€‚è¿™ä¸ªå‡½æ•°é€šå¸¸æ²¡æœ‰ `return` è¯­å¥ï¼Œä½†æ˜¯åœ¨ä½ è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªåå­—å«åš generator çš„è¿­ä»£å™¨ã€‚

è¿™ä¸ªå« Generator çš„è¿­ä»£å™¨ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå®ƒå°±åƒä¸€ä¸ªä¹¦ç­¾ï¼Œä¼šè®°å½•ä½ å½“å‰éå†åˆ°å“ªä¸ªä½ç½®ï¼ˆä¹Ÿå°±æ˜¯æ‰§è¡Œåˆ°äº†ç¬¬å‡ ä¸ª yield è¯­å¥ï¼‰ã€‚yield è¯­å¥å¯¹åº”çš„å€¼å°±ç›¸å½“äº `__next__()` æ–¹æ³•çš„è¿”å›å€¼ã€‚

> åœ¨ Python 3.3 æ·»åŠ äº†ä¸€ä¸ªæ–°çš„è¯­æ³•ï¼Œè®©è¿­ä»£å™¨æ›´åŠ æ–¹ä¾¿ï¼š<div>

```python
yield from Iterable
```

å¯ä»¥å¿«é€Ÿä½¿ç”¨ç”Ÿæˆå™¨è¿­ä»£ä¸€ä¸ª Iterable, ç›¸è¾ƒäºä¹‹å‰çš„ï¼š

```python
for i in [1, 2, 3]:
	yield i
```

ç°åœ¨å¯ä»¥ï¼š

```python
yield from [1, 2, 3]
```

</div>

!! Cheat Sheet

```python
 sequence
  +
  |
  v
   def __getitem__(self, index: int):
  +    ...
  |    raise IndexError
  |
  |
  |              def __iter__(self):
  |             +     ...
  |             |     return <iterator>
  |             |
  |             |
  +--> or <-----+        def __next__(self):
       +        |       +    ...
       |        |       |    raise StopIteration
       v        |       |
    iterable    |       |
           +    |       |
           |    |       v
           |    +----> and +-------> iterator
           |                               ^
           v                               |
   iter(<iterable>) +----------------------+
                                           |
   def generator():                        |
  +    yield 1                             |
  |                 generator_expression +-+
  |                                        |
  +-> generator() +-> generator_iterator +-+
```


!! Iterator vs Generator

æ—¢ç„¶ Generator å°±æ˜¯ä¸€ä¸ª Iteratorï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ç›´æ¥å»å®ç° Iteratorå‘¢ï¼Ÿå› ä¸º Generator æ›´æ–¹ä¾¿å‘€ğŸ˜“ã€‚

ç›¸æ¯”è¾ƒäº Iteratorï¼Œ Generator æ–¹ä¾¿å®ç°ï¼Œå¹¶ä¸”èƒ½æ»¡è¶³ç»å¤§éƒ¨åˆ†çš„éœ€æ±‚ã€‚

è€Œ Iterator è™½ç„¶å®ç°éº»çƒ¦ä¸€ç‚¹ï¼Œä½†æ˜¯ç¡®å®å¯ä»¥æ›´åŠ çµæ´», ä¾‹å¦‚é™¤äº†å®ç° `__next__()` æ–¹æ³•ä»¥å¤–ï¼Œä½ è¿˜å¯ä»¥å®ç°ä¸€äº›å…¶ä»–çš„æœ‰ç”¨çš„æ–¹æ³•ï¼Œä¾‹å¦‚ `current()` æ–¹æ³•è·å–å½“å‰ä½ç½®ã€‚

---

!! Reference

* [[Difference between Python's Generators and Iterators|https://stackoverflow.com/a/2776865/12572033]]
* [[What exactly are iterator, iterable, and iteration?|https://stackoverflow.com/a/9884259/12572033]]