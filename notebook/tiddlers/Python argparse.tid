caption: å‘½ä»¤è¡Œå‚æ•°è§£æ argparse
created: 20190704003117115
creator: liyzcj
modified: 20200404140044780
modifier: liyzcj
tags: [[Python Built-in]] Migrated
title: Python argparse
type: text/vnd.tiddlywiki

! argparse
---

argparse æ˜¯ [[optparse]] çš„å‡çº§ç‰ˆæœ¬, æ›´åŠ çµæ´»ä¹Ÿæ–¹ä¾¿ä½¿ç”¨. æ¨èä½¿ç”¨è¯¥æ¨¡ç»„å®ç°è„šæœ¬å‚æ•°ä¼ é€’.

argparse çš„ä½¿ç”¨åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤

# åˆ›å»º `ArgumentParser` å¯¹è±¡
# ä½¿ç”¨ `add_argument()` æ–¹æ³•æ·»åŠ å‚æ•°é€‰é¡¹
# ä½¿ç”¨ `parse_args()` æ–¹æ³•è§£æå‚æ•°

!!! åˆ›å»ºè§£æå™¨å¯¹è±¡

```python
parser = argparse.ArgumentParser()
```

å¯é€‰å‚æ•°:

* `prog` : è„šæœ¬åç§°(default: `sys.argv[0]`)
* `usage` : å¸®åŠ©ä¿¡æ¯(default: è‡ªåŠ¨ç”Ÿæˆ)
* `description` : æ˜¾ç¤ºåœ¨å¸®åŠ©ä¹‹å‰çš„æè¿°(default: `None`)
* `epilog` : æ˜¾ç¤ºåœ¨å¸®åŠ©ä¹‹åçš„æ–‡æœ¬ (default: `None`)
* `parents` : åŒ…å«å¤šä¸ª `ArgumentParser` å¯¹è±¡çš„ List, åŒæ ·éœ€è¦è¢«è§£æçš„å‚æ•°.
* `formatter_class` : æ ¼å¼åŒ–å¸®åŠ©ä¿¡æ¯çš„ç±»
* `prefix_chars` : åŒ…å«å¯é€‰å‚æ•°å‰ç¼€çš„ Set (default: `{-}`)
* `fromfile_prefix_chars` : ä»æ–‡ä»¶è¯»å–å‚æ•°å‰ç¼€ (default: `None`)
* `argument_default` : å‚æ•°å…¨å±€é»˜è®¤å€¼ (default: `None`)
* `conflict_handler` : è§£å†³å‚æ•°å†²çªçš„ç­–ç•¥(usually unnecessary)
* `add_help` : å¢åŠ  `-h/--help` é€‰é¡¹ (default: `True`)
* `allow_abbrev` : å…è®¸é•¿é€‰é¡¹ç¼©å†™, 3.5ç‰ˆæœ¬åŠ å…¥(default: `True`)

> è¯¦ç»†ä¿¡æ¯è§: [ext[ArgumentParser objects|https://docs.python.org/3/library/argparse.html#argumentparser-objects]]

!!! å¢åŠ éœ€è¦è§£æçš„å‚æ•°é€‰é¡¹

```python
ArgumentParser.add_argument(name or flags...[key args])
```

å‚æ•°:

* `name or flags` : åç§°æˆ–flag. ä¾‹å¦‚ `foo, -f, --foo`
* `action` : å½“å‚æ•°ä¼ å…¥æ—¶æ‰§è¡Œçš„åŠ¨ä½œ. (default: `store`)
* `nargs` : é€‰é¡¹æ¶ˆè€—çš„å‚æ•°ä¸ªæ•°.
* `const` : å¸¸é‡, ç”¨äº `action` æˆ–ç€ `nargs`
* `default` : é€‰é¡¹çš„é»˜è®¤å€¼
* `type` : å‚æ•°ç±»å‹
* `choices` : æ‰€å…è®¸å‚æ•°å€¼çš„å®¹å™¨
* `required` : æ˜¯å¦å¯ä»¥çœç•¥(ä»…å¯é€‰å‚æ•°)
* `help` : å¸®åŠ©æè¿°
* `metavar` : å¸®åŠ©ä¸­æ˜¾ç¤ºçš„åç§°
* `dest` : è§£æåçš„å˜é‡åç§°

> è¯¦ç»†ä¿¡æ¯è§: [ext[the-add-argument-method|https://docs.python.org/3/library/argparse.html#the-add-argument-method]]

---

!! ç®€å•ç¤ºä¾‹

```python
import argparse

parser = argparse.ArgumentParser(description="This is a example.")
parser.parse_args()
```

> ğŸ’¡ å¦‚æœæ²¡æœ‰ä¼ é€’å‚æ•°ç»™ `parse_args()` æ–¹æ³•, åˆ™é»˜è®¤è§£æ `sys.argv`.

é»˜è®¤æ‹¥æœ‰ `-h` æˆ– `--help` é€‰é¡¹:

```bash
PS D:\znote> python.exe test.py -h
usage: test.py [-h]

This is a example.

optional arguments:
  -h, --help  show this help message and exit
```

!! ä½ç½®å‚æ•°

ä½ç½®å‚æ•°çš„æ„æ€å°±æ˜¯åƒæ™®é€šçš„å‡½æ•°å‚æ•°ä¸€æ ·æ ¹æ®å‚æ•°ä¼ å…¥çš„ä½ç½®æ¥ç¡®å®šå‚æ•°, è€Œ ''ä¸éœ€è¦æŒ‡å®šå‚æ•°é€‰é¡¹'':

```python
import argparse

parser = argparse.ArgumentParser(description="This is a example.")
parser.add_argument('loc1', help='è¿™æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°.')
args = parser.parse_args()
print(args.loc1)
```

æ‰§è¡Œä»£ç : 

```bash
PS D:\znote> python.exe test.py one
one
```

æŸ¥çœ‹å¸®åŠ©é€‰é¡¹:

```bash
PS D:\znote> python.exe test.py -h
usage: test.py [-h] loc1

This is a example.

positional arguments:
  loc1        è¿™æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°.

optional arguments:
  -h, --help  show this help message and exit
```

é»˜è®¤æ¥å—çš„å‚æ•°æ˜¯ string ç±»å‹çš„, æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºä½ç½®å‚æ•°æ·»åŠ æ•°æ®ç±»å‹:

```python
import argparse

parser = argparse.ArgumentParser(description="This is a example.")
parser.add_argument('squre', help='è¿™æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°.', type=int)
args = parser.parse_args()
print(args.squre ** 2)
```

> ğŸ’¡ å¸®åŠ©ä¿¡æ¯ä¸ä¼šæç¤ºå‚æ•°å€¼çš„æ•°æ®ç±»å‹

!! å¯é€‰å‚æ•°

å¯é€‰å‚æ•°åŒæ ·ä½¿ç”¨ `add_argument()` æ–¹æ³•æ·»åŠ :

```python
import argparse

parser = argparse.ArgumentParser(description="æ±‚å¹³æ–¹")
parser.add_argument('--verbose', action = 'store_true', help="æé«˜è¾“å‡ºæ˜¾ç¤ºç­‰çº§")
args = parser.parse_args()
if args.verbose:
  print("è¾“å‡ºæ‰“å¼€.")
```

è¾“å‡º:

```bash
PS D:\znote> python.exe test.py --verbose
è¾“å‡ºæ‰“å¼€.
```

è¿™é‡Œé‡‡ç”¨äº†ä¸€ä¸ª `action` å‚æ•°, æä¾›äº†ä¸€ä¸ª `store_true` åŠ¨ä½œ, è¡¨æ˜ `verbose` é€‰é¡¹æŒ‡å®šæ—¶, `verbose` å˜é‡ä¸º `True`, å¦åˆ™ä¸º `False`.

---

!! add_argument() æ–¹æ³•å‚æ•°

!!! åŠ¨ä½œç±»å‹

`action` å‚æ•°æä¾›äº†''å…«ç§ç±»å‹''çš„åŠ¨ä½œ, é™¤æ­¤ä¹‹å¤–ä¹Ÿå¯ä»¥è‡ªå®šä¹‰åŠ¨ä½œ.

|!åŠ¨ä½œ|!ä»‹ç»|
|store |é»˜è®¤åŠ¨ä½œ, ç›´æ¥å­˜å‚¨åˆ°å˜é‡, æ¶ˆè€—ä¸€ä¸ªå‚æ•°|
|store_const |é…åˆconst, å°†constå­˜è¿›å˜é‡, ä¸æ¶ˆè€—å‚æ•°|
|store_true |å­˜å‚¨ True è¿›å˜é‡, æœªæŒ‡å®šå­˜å‚¨ False|
|append |å°†å‚æ•° Append åˆ°ä¸€ä¸ª List å¯¹è±¡|
|append_const |é…åˆconst, å°†å¸¸é‡ Append åˆ° List|
|count |ç»Ÿè®¡å‚æ•°å‡ºç°çš„æ¬¡æ•°|
|help |æ‰“å° help, ~ArgumentParser é»˜è®¤æœ‰ä¸€ä¸ª|
|version |é…åˆ version, æ‰“å° version å¹¶é€€å‡º|

> è¯¦è§: [ext[action|https://docs.python.org/3/library/argparse.html#action]]

!!! nargs

`nargs` å‚æ•°ä»£è¡¨æ¶ˆè€—å‚æ•°çš„ä¸ªæ•°. å¯å–çš„å€¼æœ‰å¦‚ä¸‹å‡ ç§:

* `N` : ä¸€ä¸ªæ•´å‹æ•°å­—, ä»£è¡¨æ¶ˆè€—å‚æ•°çš„ä¸ªæ•°. <div>

è¿™ä¼šå°†æ¶ˆè€—çš„å‚æ•°ä¿å­˜ä¸º List å­˜è¿›å˜é‡ä¸­, å³ä½¿ `N = 1`, ä¹Ÿä¼šä¿å­˜ List, è€Œä¸æ˜¯ String. æ‰€ä»¥`N = 1` æ—¶ä¸é»˜è®¤ä¹Ÿä¸ç›¸åŒ.

</div>

* `?` : åˆ¤æ–­å½¢å¼ <div>

è‹¥é€‰é¡¹åæœ‰å‚æ•°, åˆ™ä¿å­˜å‚æ•°è¿›å˜é‡; è‹¥é€‰é¡¹åæ²¡æœ‰å‚æ•°, åˆ™ä¿å­˜ const å‚æ•°çš„å€¼è¿›å˜é‡; è‹¥é€‰é¡¹ æ²¡æœ‰å‡ºç°, åˆ™ä¿å­˜ default çš„å€¼è¿›å‚æ•°.

å¸¸ç”¨çš„æ–¹æ³•æ˜¯é‡å®šå‘è¾“å…¥è¾“å‡ºæ–‡ä»¶:

```python
>>> parser = argparse.ArgumentParser()
>>> parser.add_argument('infile', nargs='?', type=argparse.FileType('r'),
                    default=sys.stdin)
>>> parser.add_argument('outfile', nargs='?', type=argparse.FileType('w'),
                    default=sys.stdout)
>>> parser.parse_args(['input.txt', 'output.txt'])
Namespace(infile=<_io.TextIOWrapper name='input.txt' encoding='UTF-8'>,
        outfile=<_io.TextIOWrapper name='output.txt' encoding='UTF-8'>)
>>> parser.parse_args([])
Namespace(infile=<_io.TextIOWrapper name='<stdin>' encoding='UTF-8'>,
        outfile=<_io.TextIOWrapper name='<stdout>' encoding='UTF-8'>)
```
</div>

* `*` : å°†é€‰é¡¹åçš„æ‰€æœ‰å‚æ•°å­˜è¿› List å˜é‡
* `+` : ä¸ `*` ç±»ä¼¼, ä½†è‡³å°‘ä¸ºä¸€ä¸ªå‚æ•°
* `argparse.REMAINDER` : æ‰€æœ‰å‰©ä½™çš„æœªè§£æå‚æ•°å­˜è¿› List å˜é‡

!!! type

ç±»å‹è½¬æ¢, å°†æ”¶åˆ°çš„å­—ç¬¦ä¸²å‚æ•°è½¬æ¢ä¸ºç‰¹å®šç±»å‹:

```python
>>> parser = argparse.ArgumentParser()
>>> parser.add_argument('foo', type=int)
>>> parser.add_argument('bar', type=open)
>>> parser.parse_args('2 temp.txt'.split())
Namespace(bar=<_io.TextIOWrapper name='temp.txt' encoding='UTF-8'>, foo=2)
```

ä¸ºäº†æ–¹ä¾¿æ‰“å¼€å„ç§ç±»å‹çš„æ–‡ä»¶, `argparse` æä¾›äº† `FileType` ç±»å‹æ¥æ”¶ `mode=, bufsize=, encoding= and errors=` å‚æ•°æ¥ä¼ é€’ç»™ `open()` æ–¹æ³•, ä¾‹å¦‚:

```python
>>> parser = argparse.ArgumentParser()
>>> parser.add_argument('bar', type=argparse.FileType('w'))
>>> parser.parse_args(['out.txt'])
Namespace(bar=<_io.TextIOWrapper name='out.txt' encoding='UTF-8'>)
```

> ğŸ’¡ type å¯ä»¥æ¥å—ä»»ä½•ä»¥å­—ç¬¦ä¸²ä¸ºè¾“å…¥, è¿”å›ä¸€ä¸ªå€¼çš„å‡½æ•°. è¿™æ ·å°±å¯ä»¥æ–¹ä¾¿çš„å°†å­—ç¬¦ä¸²å‚æ•°è½¬æ¢ä¸ºå„ç§ python å¯¹è±¡.

!!! choice

`choices` å¯ä»¥å¯¹è¾“å…¥çš„å‚æ•°çš„å€¼è¿›è¡Œé™å®š.

å°†ä¸€ç»„å¯é€‰çš„å€¼ä½œä¸º List ä¼ é€’ç»™ `choices` , æ³¨æ„åº”ä¸ `type` æŒ‡å®šçš„ç±»å‹ç›¸åŒ.

```python
>>> parser = argparse.ArgumentParser(prog='doors.py')
>>> parser.add_argument('door', type=int, choices=range(1, 4))
>>> print(parser.parse_args(['3']))
Namespace(door=3)
>>> parser.parse_args(['4'])
usage: doors.py [-h] {1,2,3}
doors.py: error: argument door: invalid choice: 4 (choose from 1, 2, 3)
```

!!! dest

dest æŒ‡å®šäº†ä¿å­˜å˜é‡çš„åç§°.

!! å‚æ•°ç»„

{{python argparse group argument}}

!! å­å‘½ä»¤

{{python argparse subcommand}}

---

Argparse è¿˜æä¾›äº†ä¸€äº›å…¶ä»–å‡½æ•°, è¯¦ç»†å‚è€ƒ: [ext[other-utilities|https://docs.python.org/3/library/argparse.html#other-utilities]]