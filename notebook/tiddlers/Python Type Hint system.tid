caption: ç±»å‹æç¤ºç³»ç»Ÿ
created: 20200322042822846
modified: 20200404125120698
tags: [[Python é«˜çº§åº”ç”¨]] Survey
title: Python Type Hint system
type: text/vnd.tiddlywiki

! The state of type hints in Python



> ç¿»è¯‘è‡ª [[The state of type hints in Python|https://www.bernat.tech/the-state-of-type-hints-in-python/]]

Python ä¸€ä¸ªä¸»è¦çš„å–ç‚¹æ˜¯åŠ¨æ€ç±»å‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„é¸­å­ç±»å‹ã€‚ä¸€ä¸ªå¯¹è±¡åªè¦ "çœ‹èµ·æ¥åƒé¸­å­ï¼Œèµ°èµ·è·¯æ¥åƒé¸­å­" é‚£å®ƒå°±å¯ä»¥è¢«çœ‹åšæ˜¯é¸­å­ã€‚æ—¢ç„¶æ˜¯å–ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªç‰¹æ€§æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚ä¸è¿‡åœ¨2014 å¹´ä¹æœˆçš„æ—¶å€™ï¼ŒPython çš„ BDFL æå‡ºäº†ä¸€ä¸ªè®®æ¡ˆ ([[PEP-484|https://www.python.org/dev/peps/pep-0484)]] æ¥å¯¹å‚æ•°è¿›è¡Œç±»å‹æç¤ºã€‚è¿™ä¸ªç‰¹æ€§åœ¨ä¸€å¹´ä¹‹åï¼Œä¹Ÿå°±æ˜¯ 2015 å¹´ä¹æœˆéšç€ Python 3.5.0 ç‰ˆæœ¬å‘å¸ƒã€‚æ•´æ•´ 25å¹´äº†ï¼ŒPython ä»£ç ç»ˆäºæœ‰äº†æ ‡å‡†çš„ç±»å‹æç¤ºã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦æ¢ç´¢è¿™ä¸ªç³»ç»Ÿçš„æˆç†Ÿå‹ï¼Œå¦‚ä½•ä½¿ç”¨è¿™ä¸ªç³»ç»Ÿï¼Œä»¥åŠç±»å‹æç¤ºçš„æœªæ¥ã€‚

!! ä¸ºä½•éœ€è¦ç±»å‹æç¤ºï¼Ÿ

!!! è®¾è®¡ç±»å‹æç¤ºä¸ºäº†ä»€ä¹ˆï¼Ÿ

é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ç±»å‹æç¤ºã€‚ç±»å‹æç¤ºæœ‰å¾ˆå¤šçš„å¥½å¤„ï¼Œè®©æˆ‘ä»¬æ ¹æ®é‡è¦æ€§ä¸€ä¸€ç½—åˆ—ã€‚

!!!! 1. å¯ä»¥æ›´åŠ å®¹æ˜“çš„ç†è§£ä»£ç 

çŸ¥é“ä¸€ä¸ªå‚æ•°çš„ç±»å‹å¯ä»¥ä½¿ä»£ç æ›´åŠ å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªå‡½æ•°ã€‚ä½ å¯èƒ½åœ¨åˆ›å»ºè¿™ä¸ªå‡½æ•°çš„æ—¶å€™çŸ¥é“å®ƒçš„å‚æ•°å’Œè¿”å›å€¼æ˜¯ä»€ä¹ˆç±»å‹ï¼Œä½†æ˜¯å‡ ä¸ªæœˆåå°±ä¸æ˜¯è¿™ç§æƒ…å†µäº†ã€‚åœ¨ä»£ç ä¸­æ˜¾ç¤ºå‡ºå‚æ•°ä¸è¿”å›å€¼çš„ç±»å‹å¯ä»¥è®©ä½ ä¸‹æ¬¡æŸ¥çœ‹è¿™ä¸ªå‡½æ•°çš„æ—¶å€™èƒ½å¤Ÿæ›´å¿«çš„ get åˆ°å‡ ä¸ªæœˆå‰çš„æƒ³æ³•ã€‚è®°ä½ï¼Œä½ è¯»ä»£ç çš„æ—¶å€™è‚¯å®šæ¯”å†™ä»£ç çš„æ—¶å€™å¤šã€‚å› æ­¤ï¼Œä½ åº”è¯¥ä¸ºäº†ä»£ç çš„å¯ç†è§£æ€§è¿›è¡Œä¸€äº›ä¼˜åŒ–ã€‚

æ‹¥æœ‰ç±»å‹æç¤ºçš„å‡½æ•°ä¼šæç¤ºä½ è°ƒç”¨çš„æ—¶å€™ä¼ é€’ä»€ä¹ˆå‚æ•°ã€‚å¹¶ä¸”å½“ä½ è¦ä¿®æ”¹æˆ–è€…æ‰©å±•è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå®ƒä¼šå‘Šè¯‰ä½ è¾“å…¥è¾“å‡ºçš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢è¿™ä¸ªå‘é€ request çš„å‡½æ•°ï¼š

```python
def send_request(request_data : Any,
                 headers: Optional[Dict[str, str]],
                 user_id: Optional[UserId] = None,
                 as_json: bool = True):
    ...
```

ä»…ä»…çœ‹ signature è¿™éƒ¨åˆ†æˆ‘å°±çŸ¥é“ï¼Œrequest_data å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œ headers åº”è¯¥æ˜¯ä¸€ä¸ªé”®å€¼å¯¹éƒ½æ˜¯ str çš„å­—å…¸ã€‚ç”¨æˆ·çš„ä¿¡æ¯ user_id ä¹Ÿæ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå¹¶ä¸”ç±»å‹æ˜¯ UserIdï¼Œas_json æ˜¯ä¸€ä¸ªå¸ƒå°”å˜é‡ã€‚

äº‹å®ä¸Šæˆ‘ä»¬æ—©å°±çŸ¥é“äº†ç±»å‹ä¿¡æ¯æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯åœ¨ä¹‹å‰æˆ‘ä»¬å¹¶æ²¡æœ‰å¾ˆå¥½çš„åŠæ³•æ¥å°†ç±»å‹ä¿¡æ¯å±•ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠç±»å‹ä¿¡æ¯å†™åˆ° docstring ä¸­ã€‚ç±»å‹æç¤ºç³»ç»Ÿæä¾›äº†ä¸€ä¸ªæ›´å¥½çš„åŠæ³•æ¥å£°æ˜å˜é‡å¤æ‚çš„ç±»å‹ã€‚å¹¶ä¸”ä¸€äº› linters ä¹Ÿå¯ä»¥æ£€æŸ¥è¿™äº›ç±»å‹æç¤ºæ¥ä¿è¯æ•´ä¸ªç¨‹åºçš„æ­£å¸¸è¿è½¬ã€‚

!!!! 2. æ›´æ–¹ä¾¿çš„é‡æ„ä»£ç 

ç±»å‹æç¤ºå¯ä»¥è®©ä½ æ›´æ–¹ä¾¿çš„é‡æ„ä»£ç ã€‚ä¾‹å¦‚ï¼Œå½“ä½ æƒ³è¦é‡æ„ä¸€ä¸ªç±»æ—¶ï¼Œç±»å‹æç¤ºèƒ½å¤Ÿè®©ä½ æ–¹ä¾¿çš„æ‰¾åˆ°å“ªäº›åœ°æ–¹ä½¿ç”¨äº†è¿™ä¸ªç±»ã€‚è™½ç„¶ä¹‹å‰ä¸€äº› IDE å·²ç»åœ¨å°è¯•ç€å»åšè¿™ä»¶äº‹ï¼Œä½†æ˜¯ç±»å‹æç¤ºå¯ä»¥è®©å®ƒä»¬æ›´åŠ å‡†ç¡®çš„å®ç°ç™¾åˆ†ä¹‹ç™¾çš„æ£€æµ‹ã€‚æ‰€ä»¥ï¼Œç±»å‹æç¤ºæä¾›äº†ä¸€ä¸ªæ›´åŠ å¹³æ»‘å’Œå‡†ç¡®çš„æ–¹æ³•æ¥æ£€æµ‹è¿™äº›ç±»æ˜¯æ€ä¹ˆåœ¨ä»£ç ä¸­è¿è¡Œçš„ã€‚

ä½†æ˜¯ç±»å‹æç¤ºæ¯•ç«Ÿä»…ä»…æ˜¯ç±»å‹æç¤ºï¼Œä½ çš„å˜é‡åœ¨è¿è¡Œçš„æ—¶å€™ä»ç„¶å¯èƒ½æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡ã€‚æ‰€ä»¥è¿˜æ˜¯è¦ä½¿ç”¨ `isinstance()` æ–¹æ³•æ¥ç¡®å®šå˜é‡çš„ç±»å‹ã€‚

!!!! 3. æ›´åŠ æ–¹ä¾¿çš„ä½¿ç”¨åº“

æ‹¥æœ‰ç±»å‹æç¤ºæ„å‘³ç€ IDE å¯ä»¥æœ‰æ›´åŠ å‡†ç¡®å’Œèªæ˜çš„çš„æç¤ºå†…å®¹ã€‚ç°åœ¨ï¼Œå½“ä½ ä½¿ç”¨è‡ªåŠ¨è¡¥å…¨æ—¶ï¼ŒIDE å¯ä»¥å®Œå…¨çš„è§£æå‡ºä¸€ä¸ªå‚æ•°æœ‰å“ªäº›æ–¹æ³•å’Œå±æ€§ï¼Œå› ä¸ºå®ƒçŸ¥é“è¿™ä¸ªå‚æ•°æ˜¯ä»€ä¹ˆç±»å‹ã€‚æ­¤å¤–ï¼Œå¦‚æœç”¨æˆ·å°è¯•ç€å»è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„ä¸œè¥¿æˆ–è€…ä¼ é€’äº†ä¸€ä¸ªä¸å¯¹çš„ç±»å‹ï¼ŒIDE å¯ä»¥å°†å®ƒæ£€æµ‹å‡ºæ¥ã€‚

[img[https://www.bernat.tech/content/images/2018/05/editor_suggest.png]]

!!!! 4. Type linter

[img[https://www.bernat.tech/content/images/2018/05/type_missmatch.jpg]]

è™½ç„¶ IDE èƒ½å¤Ÿæ˜¾ç¤ºå‡ºé”™è¯¯çš„å‚æ•°ç±»å‹éå¸¸ä¸é”™ï¼Œä¸€ä¸ªæ›´åŠ å¥½çš„æ‰©å±•æ˜¯æœ‰ä¸€ä¸ª linter å·¥å…·èƒ½å¤Ÿç¡®ä¿ç±»å‹ç¬¦åˆç¨‹åºçš„é€»è¾‘ã€‚è¿è¡Œè¿™ä¸ªå·¥å…·èƒ½å¤Ÿå¸®åŠ©ä½ è¾ƒæ—©çš„å‘ç° bugï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œå®ƒçš„è¾“å…¥å¿…é¡»æ˜¯ä¸€ä¸ª strï¼Œä¼ é€’ None è¿™ä¸ªå‡½æ•°ä¼šé€ æˆé”™è¯¯ï¼š

```python
def transform(arg):
    return 'transformed value {}'.format(arg.upper())
    
transform(None) # if arg would be type hinted as str the type linter could warn that this is an invalid call
```

å¯èƒ½æœ‰äº›äººä¼šè¯´è¿™ç§ç®€å•çš„é”™è¯¯å¾ˆå®¹æ˜“å‘ç°ï¼Œä½†æ˜¯è¯·è®°ä½ï¼Œå³ä½¿åœ¨å¾ˆå¤æ‚çš„æƒ…å†µä¸‹ï¼Œè¿™ç§é€»è¾‘ä»ç„¶å¯ä»¥å·¥ä½œã€‚ä¾‹å¦‚ä¸€äº›åµŒå¥—çš„å‡½æ•°è°ƒç”¨ï¼š

```python
def construct(param=None):
    return None if param is None else ''

def append(arg):
    return arg + ' appended'
    
transform( append( construct() ) )
```

å°½ç®¡æœ‰è®¸å¤šè®¸å¤šçš„ lintersï¼Œä½†æ˜¯ Python ç±»å‹æ£€æŸ¥çš„å…¸å‹æ˜¯ç°å®æ˜¯ [[mypy|http://mypy-lang.org/]]ã€‚ mypy æ˜¯ä¸€ä¸ª Python å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†å®ƒåº”ç”¨åˆ°ä¸€ä¸ªæŒç»­é›†æˆçš„ç®¡é“ä¸­ã€‚

!!!! 5. å®æ—¶çš„æ•°æ®éªŒè¯

ç±»å‹æç¤ºå¯ä»¥è¢«ç”¨æ¥è¿›è¡Œå®æ—¶çš„æ•°æ®éªŒè¯ã€‚ä½ ä¸éœ€è¦å†å†™ä¸€é•¿ä¸²çš„ assertsã€‚å–è€Œä»£ä¹‹çš„æ˜¯ä½¿ç”¨ä¸€ä¸ªæ¡†æ¶ï¼Œè¿™ä¸ªçŸ¿å»ºå¯ä»¥æ ¹æ®ç±»å‹æç¤ºåœ¨é€»è¾‘è¿è¡Œä¹‹å‰æ¥æ£€æŸ¥æ˜¯å¦ç¬¦åˆè¦èµ·ã€‚

ä¸€ä¸ªä½¿ç”¨ [[pydantic|https://github.com/samuelcolvin/pydantic]] æ¡†æ¶çš„ä¾‹å­ï¼š

```python
from datetime import datetime
from typing import List
from pydantic import BaseModel, ValidationError

class User(BaseModel):
    id: int
    name = 'John Doe'
    signup_ts: datetime = None
    friends: List[int] = []

external_data = {'id': '123', 'signup_ts': '2017-06-01 12:22',
                 'friends': [1, 2, 3]}
user = User(**external_data)

try:
    User(signup_ts='broken', friends=[1, 2, 'not number'])
except ValidationError as e:
    print(e.json())
```

!!! ç±»å‹æç¤ºä¸æ˜¯ä¸ºäº†ä»€ä¹ˆï¼Ÿ

> From the get-go : ä»ä¸€å¼€å§‹

ä»ä¸€å¼€å§‹ï¼ŒGuido å°±æ˜ç¡®äº†è¡¨ç¤ºäº†ç±»å‹æç¤ºä¸æ˜¯ä¸ºäº†ä»¥ä¸‹è¿™äº›æƒ…å†µè®¾è®¡çš„ï¼ˆä½†æ˜¯è¿™ä¹Ÿå¹¶ä¸æ„å‘³ç€äººä»¬ä¸ä¼šåœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨ç±»å‹æç¤ºï¼Œå¼€æºä¸‡å² ğŸ˜‚ï¼‰ï¼š

!!!! 1. ä¸æ˜¯ä¸ºäº†å®æ—¶ç±»å‹æ¨ç†

Runtime è§£é‡Šå™¨ ï¼ˆCPythonï¼‰ å¹¶ä¸ä¼šå°è¯•å»æ¨ç†ç±»å‹ä¿¡æ¯ï¼Œå¹¶ä¸”ä¸ä¼šæ£€æµ‹ä¸€ä¸ªä¼ é€’è¿‡æ¥çš„å˜é‡æ˜¯å¦ç¬¦åˆæŒ‡å®šç±»å‹ã€‚

!!!! 2. ä¸æ˜¯ä¸ºäº†æ€§èƒ½è°ƒä¼˜

Runtime è§£é‡Šå™¨ ï¼ˆCPythonï¼‰ä¹Ÿä¸ä¼šä½¿ç”¨ç±»å‹ä¿¡æ¯å¯¹ç”Ÿæˆçš„äºŒè¿›åˆ¶ä»£ç è¿›è¡Œä»»ä½•çš„ä¼˜åŒ–ã€‚å½“æ‰§è¡Œä»£ç çš„æ—¶å€™ï¼Œä»…ä»…å°†ç±»å‹ä¿¡æ¯å½“ä½œæ³¨é‡Šå¤„ç†ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥ä¸¢æ‰ã€‚

è¿™é‡Œçš„å…³é”®ç‚¹æ˜¯ç±»å‹æç¤ºæ˜¯è®¾è®¡æ¥æå‡å¼€å‘è€…çš„å¼€å‘ä½“éªŒçš„ï¼Œå®ƒå¹¶ä¸ä¼šå½±å“ä½ çš„ä»£ç æ˜¯å¦‚ä½•è¿è¡Œçš„ã€‚''ä¹Ÿå°±æ˜¯è¯´ä»–å¯ä»¥è®©å¼€å‘è€…å†™ä»£ç å†™çš„æ›´å¼€å¿ƒï¼Œä½†æ˜¯ä¸ä¼šè®©ä»–çš„ä»£ç è·‘çš„æ›´å¿«ã€‚''



!! ç±»å‹æç¤ºæ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„ç³»ç»Ÿ

Python çš„ç±»å‹æç¤ºæ˜¯æ¸è¿›çš„ã€‚æ„æ€å¦‚æœä½ ä¸æ·»åŠ ç±»å‹æç¤ºï¼Œé‚£ä¹ˆå°±é»˜è®¤å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ã€‚è¿™æ ·çš„è¯ä½ å¯ä»¥é€æ¸çš„ä¿®æ”¹ä½ çš„ä»£ç ï¼Œè®©å®ƒå˜æˆç±»å‹å¯çŸ¥çš„ã€‚å¯ä»¥å¢åŠ ç±»å‹æç¤ºçš„æœ‰ï¼š

* å‡½æ•°å‚æ•°
* å‡½æ•°è¿”å›å€¼
* å˜é‡

è®°ä½åªæœ‰æ‹¥æœ‰ç±»å‹æç¤ºçš„ä»£ç ä¼šè¢« linter å·¥å…·è¿›è¡Œç±»å‹æ£€æµ‹ã€‚å½“ä½ ä½¿ç”¨ç±»ä¼¼äº mypy è¿™ç§ linter å·¥å…·çš„æ—¶å€™ï¼Œå®ƒä»¬å¯ä»¥æ£€æŸ¥å‡ºä½ çš„å‚æ•°ä¸æŒ‡å®šçš„ç±»å‹ä¸åŒ¹é…ï¼Œå¹¶æŠ¥é”™ã€‚

```python
! tests/test_magic_field.py
f = MagicField(name=1, MagicType.DEFAULT)
f.names()
```

ä¸Šè¿°ä»£ç ä¼šäº§ç”Ÿä»¥ä¸‹è¾“å‡ºï¼š

```bash
bernat@uvm ~/python-magic (masterâ—)$ mypy --ignore-missing-imports tests/test_magic_field.py
tests/test_magic_field.py:21: error: Argument 1 to "MagicField" has incompatible type "int";
    expected "Union[str, bytes]"
tests/test_magic_field.py:22: error: "MagicField" has no attribute "names"; maybe "name" or "_name"?
```

mypy ä¸ä»…å¯ä»¥æ£€æŸ¥å‡ºä¼ å…¥çš„å‚æ•°ç±»å‹æ˜¯å¦åŒ¹é…ï¼Œè¿˜å¯ä»¥æ£€æŸ¥å‡ºä¸€ä¸ªå¯¹è±¡åŒ…å«å“ªäº›å±æ€§ï¼Œå¹¶åœ¨ä½ è®¿é—®ä¸å­˜åœ¨çš„å±æ€§æ—¶æŠ¥é”™ã€‚åè€…å¯ä»¥ç”¨æ¥åœ¨ä½ ç¼–å†™ä»£ç æ—¶è¿›è¡Œå±æ€§æç¤ºï¼Œå‡å°‘æ‹¼å†™é”™è¯¯ã€‚

!!! å¦‚ä½•ç¼–å†™ç±»å‹æç¤ºï¼Ÿ

å½“ä½ å†³å®šä¸ºä½ çš„ä»£ç æ·»åŠ ç±»å‹æç¤ºçš„æ—¶å€™ï¼Œä½ å°†ä¼šæ„è¯†åˆ°æœ‰å¾ˆå¤šç§æ–¹æ³•å¯ä»¥æ·»åŠ ç±»å‹æç¤ºã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ



!!!! 1. ç±»å‹æ³¨è§£

```python
from typing import List

class A(object):
    def __init__() -> None:
         self.elements : List[int] = []

   def add(element: int) -> None:
         self.elements.append(element)
```

ç±»å‹æ³¨è§£æ˜¯æ·»åŠ ç±»å‹æç¤ºçš„æœ€ç›´æ¥çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯ä½ åœ¨ [[typing æ–‡æ¡£|https://docs.python.org/3/library/typing.html]]ä¸­æœ€å¸¸è§çš„æ–¹å¼ã€‚ç±»å‹æ³¨è§£çš„è¯­æ³•æœ‰ä¸¤ä¸ªææ¡ˆæå‡ºï¼š

* å‡½æ•°æ³¨è§£ï¼Œç”±[[PEP-3107|https://www.python.org/dev/peps/pep-3107/]] æå‡ºï¼Œåœ¨ Python 3.0 + ä¸­å¯ä»¥ä½¿ç”¨
* å˜é‡æ³¨è§£ï¼šç”± [[PEP-526|https://www.python.org/dev/peps/pep-0526/]] æå‡ºï¼Œåœ¨ Python 3.6 + ä¸­å¯ä»¥ä½¿ç”¨

è¿™ä¸¤ä¸ªç±»å‹æ³¨è§£çš„è¯­æ³•éƒ½æ˜¯é€šè¿‡ä½¿ç”¨ `:` è¯­æ³•æ¥å¢åŠ ç±»å‹ä¿¡æ¯ã€‚ `->` æ“ä½œç¬¦å¯ä»¥ç”¨æ¥æ ‡è®°å‡½æ•°çš„è¿”å›å€¼ã€‚

è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ï¼š

* è¿™æ˜¯å¢åŠ ç±»å‹ä¿¡æ¯çš„æœ€å…¸å‹çš„åšæ³•ï¼Œä¹Ÿæ˜¯åœ¨ä»£ç ä¸­æœ€ç®€ç­”çš„åšæ³•ã€‚
* ç”±äºç±»å‹ä¿¡æ¯é™„åŠ åœ¨ä»£ç åé¢ï¼Œæ‰€ä»¥è¿™äº›ä¿¡æ¯ä¼šéšç€ä»£ç ä¸€èµ·æ‰“åŒ…ã€‚

è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ï¼š

* æ— æ³•ä¸ä½ç‰ˆæœ¬å…¼å®¹ã€‚ç”±äºç±»å‹ä¿¡æ¯ç›´æ¥æ·»åŠ åˆ°ä»£ç ä¸­ï¼Œå¯¼è‡´ä½äº Python 3.6 ç‰ˆæœ¬æ— æ³•è¿è¡Œä»£ç ã€‚
* è¿™ç§æ–¹æ³•éœ€è¦å¯¼å…¥æ‰€æœ‰éœ€è¦çš„ç±»å‹ï¼Œå³ä½¿è¿™äº›ç±»å‹æ²¡æœ‰åœ¨å…¶ä»–ä»£ç ä¸­ä½¿ç”¨ã€‚
* åœ¨ç±»å‹æç¤ºä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å¤åˆç±»å‹ï¼Œä¾‹å¦‚ `List[int]`ã€‚ä¸ºäº†è®¡ç®—è¿™äº›å¤åˆç±»å‹ï¼Œè§£é‡Šå™¨éœ€è¦åœ¨åŠ è½½çš„æ—¶å€™è¿›è¡Œä¸€äº›é¢å¤–çš„è¿ç®—ã€‚

åä¸¤æ¡ç¼ºç‚¹æ°æ°ä¸ç±»å‹æç¤ºçš„è®¾è®¡åˆè¡·ç›¸äº’å†²çªï¼šåœ¨è¿è¡Œæ—¶ï¼Œè§£é‡Šå™¨åº”è¯¥å°†ç±»å‹ä¿¡æ¯ä½œä¸ºä»£ç çš„æ³¨é‡Šè€Œä¸éœ€è¦è¿è¡Œå®ƒã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒPython 3.7 ä»‹ç»äº†[[PEP-563 ~ postponed evaluation of annotations|https://www.python.org/dev/peps/pep-0563/]]ã€‚ å¦‚æœä½ åœ¨ä»£ç çš„æœ€å‰é¢æ‰§è¡Œï¼š

```python
from __future__ import annotations
```

é‚£ä¹ˆè§£é‡Šå™¨å°±ä¸ä¼šå»è®¡ç®—å“ªäº›å¤åˆç±»å‹ã€‚å½“è§£é‡Šå™¨åœ¨è§£æè¯­æ³•æ ‘çš„æ—¶å€™ï¼Œå®ƒä¼šæ£€æŸ¥å‡ºç±»å‹æç¤ºä¿¡æ¯ï¼Œå¹¶ä¸”å½“ä½œæ³¨é‡Šï¼Œä¸è¿›è¡Œä»»ä½•å¤„ç†ã€‚

è¿™ç§æœºåˆ¶å…è®¸ç±»å‹æç¤ºç”¨åœ¨å®ƒä»¬è¯¥è¢«ä½¿ç”¨çš„åœ°æ–¹ï¼šlinter ä¸­ã€‚åœ¨ Python 4 ä¸­ï¼Œè¿™ç§æ–¹å¼åº”è¯¥ä¼šè¢«ä½œä¸ºé»˜è®¤æ–¹å¼ã€‚

!!!! 2. ç±»å‹æ³¨é‡Š

å½“æ³¨è§£è¯­æ³•æ— æ³•ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»å‹æ³¨é‡Šï¼š

```python
from typing import List

class A(object):
    def __init__():
         # type: () -> None
         self.elements = []  # type: List[int]

   def add(element):
         # type: (List[int]) -> None
         self.elements.append(element)
```

å½“æ—¶ä½¿ç”¨è¿™ç§æ–¹å¼çš„æ—¶å€™ï¼Œä¼šæœ‰ä»¥ä¸‹å¥½å¤„ï¼š

* ç±»å‹æ³¨é‡Šå¯ä»¥åœ¨ä»»ä½• Python ç‰ˆæœ¬ä¸­æ·»åŠ ã€‚å°½ç®¡ typing åº“åœ¨ Python 3.5 ä¸­æ‰åŠ å…¥ï¼Œä½†æ˜¯å…¶ä»–ç‰ˆæœ¬çš„ Python å¯ä»¥å» PyPI ä¸­ä¸‹è½½ typing moduleã€‚è€Œä¸”ï¼Œæ³¨é‡Šæ˜¯ä»»ä½•ä¸€ä¸ª Pythonç‰ˆæœ¬éƒ½å¯ä»¥ä½¿ç”¨çš„è¯­æ³•ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼æœ‰ä¸¤ç‚¹é™åˆ¶ï¼šä¸€ä¸ªæ˜¯ç±»å‹æ³¨é‡Šéœ€è¦æ·»åŠ åˆ°å½“å‰è¡Œæˆ–è€…ä¸‹ä¸€è¡Œï¼›è¿˜æœ‰å°±æ˜¯éœ€è¦ä»¥ `type:` å¼€å¤´ã€‚
* è¿™ç§åŠæ³•ä¹Ÿæ˜¯å¯ä»¥éšç€ä»£ç ä¸€èµ·å°†ç±»å‹ä¿¡æ¯æ‰“åŒ…çš„ã€‚å°†ç±»å‹ä¿¡æ¯ä¸æºä»£ç ä¸€èµ·æ‰“åŒ…ä¼šè®©ä½¿ç”¨ä½ ä»£ç çš„äººèƒ½å¤Ÿæ›´åŠ å®¹æ˜“çš„ç†è§£ä½ çš„ä»£ç ã€‚

ä½†æ˜¯è¿™ç§æ–¹æ³•åŒæ ·ä¹Ÿæœ‰ç¼ºç‚¹ï¼š

* å°½ç®¡ç±»å‹ä¿¡æ¯ä¸å˜é‡æˆ–è€…å‚æ•°é‡Œçš„éå¸¸è¿‘ï¼Œä½†æ˜¯ä»ç„¶ä¸å¦‚ä¸Šé¢çš„ç±»å‹æ³¨è§£ç›´è§‚ã€‚è¿™æ ·ä¼šä½¿å¾—ä»£ç å˜å¾—æœ‰äº›æ··ä¹±ã€‚è€Œä¸”è¿™ç§åŠæ³•è¦æ±‚ä½ æŠŠæ³¨é‡Šåªèƒ½å†™åˆ°åŒä¸€è¡Œä¸­ï¼Œè¿™æ ·éå¸¸å®¹æ˜“é€ æˆå•è¡Œä»£ç è¿‡é•¿ã€‚
* å¦ä¸€ä¸ªé—®é¢˜æ˜¯è¿™ç§æ–¹å¼å¯èƒ½ä¼šä¸å…¶ä»–ä¹Ÿä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œè®¾ç½®çš„å·¥å…·äº§ç”Ÿå†²çªã€‚ä¾‹å¦‚ pylint
* è¿™ç§æ–¹å¼å‡ºäº†éœ€è¦ä½ å¯¼å…¥æ‰€æœ‰ä¾èµ–çš„ç±»å‹ä»¥å¤–ï¼Œè¿˜å¯èƒ½äº§ç”Ÿå¦ä¸€ä¸ªé—®é¢˜ã€‚ä½ å¯¼å…¥çš„ç±»å‹ä¿¡æ¯å¯èƒ½ä¼šè¢«ä¸€äº›linterå·¥å…·åˆ¤æ–­ä¸ºæ²¡æœ‰ä½¿ç”¨ã€‚å› ä¸ºä½ æ˜¯åœ¨æ³¨é‡Šä¸­ä½¿ç”¨è¿™äº›ä¿¡æ¯çš„ã€‚æ³¨æ„ `pylint` å·²ç»ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ï¼Œå®ƒæ˜¯é€šè¿‡å°† AST è§£æå™¨æ›´æ¢ä¸º [[typed-ast parser|https://github.com/PyCQA/pylint/issues/1063]] æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚pylint version2 ä¼šéšç€Python3.7 å‘å¸ƒã€‚

ä¸ºäº†é¿å…ä½¿å¾—ä¸€è¡Œä»£ç è¿‡é•¿ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§å°±æ˜¯å°†å‡½æ•°çš„å‚æ•°æ›´æ”¹ä¸ºä¸€è¡Œä¸€è¡Œçš„æ ¼å¼ï¼š

```python
def add(element # type: List[int]
       ):
    # type: (...) -> None
    self.elements.append(element)
```

ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ç§æ³¨é‡Šæ–¹å¼æ˜¯å¦‚ä½•è®©ä½ çš„ä»£ç å˜å¾—æ··ä¹±çš„ã€‚

ç°åœ¨å‡è®¾ä½ æœ‰ä¸‹é¢ä¸€æ®µä»£ç ï¼š

```python
@contextmanager
def swap_in_state(state, config, overrides):
    old_config, old_overrides = state.config, state.overrides
    state.config, state.overrides = config, overrides
    yield old_config, old_overrides
    state.config, state.overrides = old_config, old_overrides
```

é¦–å…ˆï¼Œä½ éœ€è¦ä¸ºå‚æ•°å¢åŠ ç±»å‹ä¿¡æ¯ï¼Œä½ éœ€è¦å°†å‚æ•°ä¸€è¡Œä¸€è¡Œçš„ç¼–å†™ï¼š

```python
@contextmanager
def swap_in_state(state,  # type: State
                  config,  # type: HasGetSetMutable
                  overrides  # type: Optional[HasGetSetMutable]
                 ):
! type: (...) -> Generator[Tuple[HasGetSetMutable, Optional[HasGetSetMutable]], None, None]
    old_config, old_overrides = state.config, state.overrides
    state.config, state.overrides = config, overrides
    yield old_config, old_overrides
    state.config, state.overrides = old_config, old_overrides
```

ä½†æ˜¯ï¼Œä½ è¦é¦–å…ˆç¡®ä¿ä½ æ­£ç¡®å¯¼å…¥äº†è¿™äº›ç±»å‹çš„ä¾èµ–ï¼š

```python
from typing import Generator, Tuple, Optional, Dict, Union, List
from magic import RunSate

HasGetSetMutable = Union[Dict, List]

@contextmanager
def swap_in_state(state,  # type: State
                  config,  # type: HasGetSetMutable
                  overrides  # type: Optional[HasGetSetMutable]
                  ):
    # type: (...) -> Generator[Tuple[HasGetSetMutable, Optional[HasGetSetMutable]], None, None]
    old_config, old_overrides = state.config, state.overrides
    state.config, state.overrides = config, overrides
    yield old_config, old_overrides
    state.config, state.overrides = old_config, old_overrides
```

ç°åœ¨è¿™äº›ä»£ç ä¼šåœ¨ä¸€äº› linterå·¥å…·ä¸­æŠ¥é”™ã€‚æ‰€ä»¥ä½ éœ€è¦å°†ä¸€äº› linter çš„åŠŸèƒ½è¿›è¡Œå±è”½ï¼š

```python
from typing import Generator, Tuple, Optional, Dict, List
from magic import RunSate

HasGetSetMutable = Union[Dict, List]  # pylint: disable=invalid-name

@contextmanager
def swap_in_state(state,  # type: State
                   config,  # type: HasGetSetMutable
                   overrides  # type: Optional[HasGetSetMutable]
                   ):  # pylint: disable=bad-continuation
    # type: (...) -> Generator[Tuple[HasGetSetMutable, Optional[HasGetSetMutable]], None, None]
    old_config, old_overrides = state.config, state.overrides
    state.config, state.overrides = config, overrides
    yield old_config, old_overrides
    state.config, state.overrides = old_config, old_overrides
```

 ç»ˆäºå®Œæˆäº†ã€‚åœ¨å¢åŠ äº†ç±»å‹æç¤ºä»¥åï¼Œä½ çš„å…­è¡Œä»£ç å˜æˆäº†16è¡Œã€‚ä½ ç°åœ¨éœ€è¦ç»´æŠ¤æ›´å¤šçš„ä»£ç äº†ï¼ï¼



!!!! 3. æ¥å£æ–‡ä»¶

è¿™ç§æ–¹å¼å…è®¸ä½ çš„ä»£ç ä¿æŒåŸæ ·ä¸å˜ï¼Œä½†æ˜¯ä½ è¦åœ¨ç›¸åŒæ–‡ä»¶å¤¹ä¸‹æ·»åŠ ä¸€ä¸ªæ–°çš„ `pyi` æ–‡ä»¶ï¼š

```python
! a.pyi alongside a.py
from typing import List

class A(object):
  elements = ... # type: List[int]
  def __init__() -> None: ...
  def add(element: int) -> None: ...
```

æ¥å£æ–‡ä»¶å¹¶ä¸æ˜¯ä¸€ä¸ªæ–°å…´çš„ä¸œè¥¿ï¼Œåœ¨ C/C++ ä¸­å·²ç»ç”¨äº†å‡ åå¹´äº†ã€‚ä½†æ˜¯ Python æ˜¯è§£é‡Šæ€§è¯­è¨€ï¼Œæ‰€ä»¥å®ƒä¸éœ€è¦æ¥å£æ–‡ä»¶è¿™ç§ä¸œè¥¿ã€‚ä½†æ˜¯ï¼Œå°±åƒä»»ä½•è®¡ç®—æœºç§‘å­¦çš„é—®é¢˜éƒ½å¯ä»¥åœ¨ä¸­é—´æ·»åŠ ä¸€å±‚ç¼“å†²å±‚ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ è¿™ä¹ˆä¸€å±‚æ¥ä¿å­˜ç±»å‹ä¿¡æ¯ã€‚

è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ï¼š

* ä½ ä¸éœ€è¦ä¿®æ”¹ä½ çš„æºä»£ç ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä»»ä½• Python ç‰ˆæœ¬ä¸­å…¼å®¹ï¼Œå› ä¸ºå…¶ä»–ç‰ˆæœ¬ä¸ä¼šå»è§£æè¿™ä¸ªæ–°çš„æ–‡ä»¶ã€‚
* åœ¨æ¥å£æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨æœ€æ–°çš„è¯­æ³•ã€‚
* å› ä¸ºä½ ä¸éœ€è¦ä¿®æ”¹ä½ çš„æºä»£ç ï¼Œè¿™æ ·èƒ½å¤Ÿå‡å°‘ bug å‡ºç°çš„å¯èƒ½æ€§ï¼Œè€Œä¸”è¿™ç§æ–¹å¼ä¹Ÿä¸ä¼šå’Œ linter å·¥å…·å†²çªã€‚
* è¿™ç§è®¾è®¡å·²ç»è¢«è®¸å¤šå®˜æ–¹çš„åº“é‡‡ç”¨ï¼Œæ‰€ä»¥å·²ç»é€šè¿‡è®¸å¤šæµ‹è¯•ã€‚
* å¯ä»¥å¯¹ä½ æ— æ³•ä¿®æ”¹çš„æºç æ·»åŠ ç±»å‹æç¤ºã€‚

è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼š

* ä½ éœ€è¦å°†ä½ çš„ä»£ç å¤åˆ¶ä¸€ä»½ï¼Œç°åœ¨æ‰€æœ‰çš„å‡½æ•°éƒ½æœ‰ä¸¤ä¸ªå®šä¹‰ã€‚
* ç°åœ¨ä½ éœ€è¦ä¸€äº›é¢å¤–çš„æ–‡ä»¶ä¸€èµ·æ‰“åŒ…è¿›ä½ çš„ä»£ç åŒ…ä¸­ã€‚
* è¿™ç§æ–¹å¼æ— æ³•å£°æ˜å˜é‡çš„ç±»å‹ã€‚
* å¹¶æ²¡æœ‰æ–¹æ³•å»æ£€æŸ¥ä½ çš„æ¥å£æ–‡ä»¶ä¸­çš„å®šä¹‰æ˜¯å¦å’Œä½ çš„å‡½æ•°ç›¸åŒï¼ˆåœ¨ IDE ä¸­ï¼Œæ€»ä¼šä½¿ç”¨ä½ çš„æ¥å£æ–‡ä»¶è¿›è¡Œæç¤ºï¼‰
* ç„¶è€Œï¼Œæœ€ä¸¥é‡çš„ç¼ºç‚¹æ˜¯ä½ åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™å¹¶æ²¡æœ‰å¯¹è±¡çš„å±æ€§æç¤ºæˆ–è€…ç±»å‹æç¤ºã€‚å› ä¸ºç±»å‹ä¿¡æ¯åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚è®¾è®¡æ¥å£æ–‡ä»¶æ˜¯ç”¨æ¥å¯¹ä¸€äº›åº“è¿›è¡Œç±»å‹æç¤ºçš„å®šä¹‰çš„ã€‚è€Œä¸æ˜¯å¯¹ä½ æ­£åœ¨ç¼–å†™çš„ä»£ç è¿›è¡Œç±»å‹æç¤ºã€‚

æœ€åä¸¤ä¸ªç¼ºç‚¹å¯¼è‡´æ ¹æ®æ¥å£æ–‡ä»¶è¿›è¡Œç±»å‹æç¤ºçš„æ£€æŸ¥éå¸¸å›°éš¾ã€‚æ‰€ä»¥æ¥å£æ–‡ä»¶æ˜¯ç”¨æ¥ä¸ºä½ çš„ç”¨æˆ·æä¾›ç±»å‹æç¤ºçš„ï¼Œè€Œä¸æ˜¯æ­£åœ¨ç¼–å†™ä»£ç çš„ä½ ï¼Œå¹¶ä¸”è¿™ç§æ–¹æ³•ä¼šå¢åŠ ç»´æŠ¤çš„è´Ÿæ‹…ï¼Œå› ä¸ºä½ è¦åŒæ—¶ç»´æŠ¤ä¸¤ä¸ªæ–‡ä»¶ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œmypy æ­£åœ¨å°è¯•ç€æä¾›è‡ªåŠ¨åˆå¹¶æ¥å£æ–‡ä»¶ä¸æºä»£ç çš„åŠŸèƒ½ã€‚ä½ å¯ä»¥åœ¨[[python/mypy ~ issue 5208|https://github.com/python/mypy/issues/5028]] ä¸­å…³æ³¨è¿™ä¸ªåŠŸèƒ½çš„è¿›å±•ã€‚

!!!! 4. Docstring

å°†ç±»å‹æç¤ºä¿¡æ¯å¢åŠ åˆ° Docstring ä¸­ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚å°½ç®¡è¿™å¹¶ä¸æ˜¯è®¾è®¡çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•è¢«å¤§å¤šæ•°çš„ IDE æ”¯æŒã€‚è¿™ä¹Ÿæ˜¯è¿›è¡Œç±»å‹æç¤ºçš„æœ€ä¼ ç»Ÿçš„æ–¹æ³•ã€‚

ä¼˜ç‚¹æ˜¯ï¼š

* ä»»ä½• Python ç‰ˆæœ¬éƒ½å¯ä»¥å·¥ä½œï¼Œåœ¨[[PEP-257|https://www.python.org/dev/peps/pep-0257/]] ä¸­æœ‰å¯¹åº”çš„å®šä¹‰ã€‚
* ä¸ä¸å…¶ä»–çš„ linter å·¥å…·å†²çªï¼Œå› ä¸ºå¤§å¤šæ•°linter å·¥å…·éƒ½ä¸ä¼šæ£€æŸ¥docstring çš„å†…å®¹ã€‚

åŒæ ·ä¹Ÿæœ‰ç¼ºç‚¹ï¼š

* æ²¡æœ‰ä¸€ç§æ ‡å‡†çš„æ–¹æ³•æ¥å¢åŠ å¤åˆç±»å‹ï¼ˆä¾‹å¦‚ oneof `int` or `bool`ï¼‰ã€‚Pycharm æœ‰ä¸€å¥—è‡ªå·±çš„è§„åˆ™ï¼Œè€Œ Sphinx æœ‰å¦ä¸€å¥—è§„åˆ™ã€‚
* éœ€è¦ä¿®æ”¹æ–‡æ¡£ï¼Œå¹¶ä¸”ä¿®æ”¹èµ·æ¥éå¸¸å›°éš¾ï¼Œå› ä¸ºæ²¡æœ‰å·¥å…·å¯ä»¥æ£€æŸ¥ä¿®æ”¹æ˜¯å¦æ­£ç¡®ã€‚
* è¿™ç§æ–¹æ³•ä¸ç±»å‹æ³¨è§£å…¼å®¹çš„ä¸æ˜¯å¾ˆå¥½ã€‚å¦‚æœåŒæ—¶ç¼–å†™äº†ç±»å‹æ³¨è§£å’Œ Docstring ï¼Œé‚£ä¹ˆåº”è¯¥æŒ‰ç…§é‚£ä¸ªç±»å‹æ¥å‘¢ã€‚

!!! å¢åŠ å“ªäº›å†…å®¹ä½œä¸ºç±»å‹æç¤º

è®©æˆ‘ä»¬æ¥æ·±å…¥æŸ¥çœ‹ä¸€äº›ç»†èŠ‚ã€‚æ›´åŠ è¯¦ç»†çš„å†…å®¹è¯·æŸ¥çœ‹[[å®˜æ–¹æ–‡æ¡£|https://docs.python.org/3/library/typing.html]]ã€‚è¿™é‡Œä»…ä»…åšä¸€ä¸ªç®€å•çš„ä»‹ç»ã€‚

!!!! 1. Nominal type



Nominal type æŒ‡çš„æ˜¯å“ªäº›åœ¨ Python è§£é‡Šå™¨ä¸­è‡ªå¸¦çš„å‚æ•°ç±»å‹ï¼š

* int
* bolean
* float
* type
* object

ç„¶åæˆ‘ä»¬æœ‰äº† generic typeï¼Œé€šå¸¸ä»¥å®¹å™¨çš„å½¢å¼å±•ç°ï¼š

```python
t : Tuple[int, float] = 0, 1.2
d : Dict[str, int] = {"a": 1, "b": 2}
d : MutableMapping[str, int] = {"a": 1, "b": 2}
l : List[int] = [1, 2, 3]
i : Iterable[Text] = [ u'1', u'2', u'3']
```

å¯¹äºè¿™äº›å¤åˆç±»å‹ï¼Œåœ¨æ¯æ¬¡éƒ½è¦å†™ä¸€éå°±å¾ˆçƒ¦ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥å®šä¹‰ä¸€ä¸ªå˜é‡ä½œä¸ºåˆ«åï¼š

```python
OptFList = Optional[List[float]]
```

ä½ ç”šè‡³å¯ä»¥ä¸ºå†…å»ºçš„ç±»å‹èµ·ä¸€ä¸ªæ–°çš„åˆ«åï¼Œè¿™å¯¹äºåŒºåˆ«ä¸¤ä¸ªç›¸åŒç±»å‹çš„å˜é‡çš„é¡ºåºç‰¹åˆ«æœ‰ç”¨ï¼š

```python
UserId = NewType('UserId', int)
user_id = UserId(524313)
count = 1
call_with_user_id_n_times(user_id, count)
```

å¯¹äº ` namedtuple` ä½ å¯ä»¥ç›´æ¥æ·»åŠ ç±»å‹ï¼ˆå’Œ ` 3.7+ ` çš„ [[data class|https://www.python.org/dev/peps/pep-0557/]] æˆ–è€… [attrs library]() éå¸¸ç›¸ä¼¼ï¼‰

> [[namedtuple()|https://docs.python.org/3/library/collections.html#collections.namedtuple]] æ˜¯ç”¨æ¥å¿«é€Ÿåˆ›å»ºi ä¸ª Tuple ç±»çš„å·¥å‚å‡½æ•°ã€‚æ¥è‡ªå†…å»º module collectionsã€‚

```python
class Employee(NamedTuple):
     name: str
     id: int
```

å¯ä»¥ä½¿ç”¨ one of æˆ–è€… Optional æ¥ä¿®é¥° typeï¼š

```python
Union[None, int, str] # one of
Optional[float] # either None or float
```

ä½ ç”šè‡³å¯ä»¥å¯¹ callback å‡½æ•°è®¾ç½®ç±»å‹æç¤ºï¼š

```python
! syntax is Callable[[Arg1Type, Arg2Type], ReturnType]
def feeder(get_next_item: Callable[[], str]) -> None:
```

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ ` TypeVar` å®šä¹‰è‡ªå·±çš„ Containersï¼š

```python
T = TypeVar('T')
class Magic(Generic[T]):
      def __init__(self, value: T) -> None:
         self.value : T = value

 def square_values(vars: Iterable[Magic[int]]) -> None:
     v.value = v.value * v.value
```

æœ€åï¼Œä½ å¯ä»¥ä½¿ç”¨ Any æ¥ç¦ç”¨ type hint

```python
def foo(item: Any) -> int:
     item.bar()
```

!!!! 2. Duck types - protocols

è¿™æ˜¯ä¸€ç§æ›´åŠ  Pythonic çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´çš„ é¸­å­ç±»å‹ã€‚

> é¸­å­ç±»å‹ï¼šå¦‚æœä¸€ä¸ªä¸œè¥¿å«èµ·æ¥åƒé¸­å­ï¼Œè·‘èµ·æ¥ä¹Ÿåƒé¸­å­ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯é¸­å­ã€‚

è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¸æ˜¯å»æ˜ç¡®çš„æŒ‡å®šä¸€ä¸ªç±»å‹è€Œæ˜¯æŒ‡å®šä½ æœŸæœ›çš„ actionï¼š

```python
KEY = TypeVar('KEY', contravariant=true)

! this is a protocol having a generic type as argument
! it has a class variable of type var, and a getter with the same key type
class MagicGetter(Protocol[KEY], Sized):
    var : KEY
    def __getitem__(self, item: KEY) -> int: ...

def func_int(param: MagicGetter[int]) -> int:
    return param['a'] * 2

def func_str(param: MagicGetter[str]) -> str:
    return '{}'.format(param['a'])
```

è¯¦æƒ…è§  [[PEP-544 ~ Protocols|https://www.python.org/dev/peps/pep-0544/]].



!! é™·é˜±



ä¸€æ—¦ä½ å¼€å§‹åœ¨ä»£ç ä¸­ä½¿ç”¨ type hintï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸€äº›å¥‡æ€ªçš„äº‹æƒ…ã€‚

åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä¼šå°è¯•ç€å»å±•ç¤ºä¸€äº›ä½ å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼š



!!!! 1. str difference between Python 2/3

è¿™é‡Œæ˜¯ä¸€ä¸ª `repr` dunder çš„å¿«é€Ÿå®ç°ï¼š

> dunder å’Œ magic method æ˜¯ä¸€ä¸ªæ„æ€ï¼ŒæŒ‡çš„æ˜¯ Python ä¸­ç”±ä¸¤è¾¹å„ä¸¤ä¸ªä¸‹åˆ’çº¿çš„æ–¹æ³•ã€‚Dunder here means â€œDouble Under (Underscores)â€

```python
from __future__ import unicode_literals

class A(object):
    def __repr__(self) -> str:
        return 'A({})'.format(self.full_name)
```

è¿™ä¸ªä»£ç åœ¨ Python 2 ä¸­ä¼šæœ‰ä¸€ä¸ª bugï¼ˆå› ä¸º Python 2 ä¸­ ` repr ` æ–¹æ³•è¿”å›çš„åº”è¯¥æ˜¯ ` bytes` ï¼Œç„¶è€Œ ` unicode_literals ` ä½¿å¾— Python 3 ä¸­è¿”å›çš„ç±»å‹æ˜¯   ` Unicode` ï¼‰è€Œä½¿ç”¨ ` from future import ` çš„æ–¹æ³•å¯¼è‡´ä½ æ— æ³•åŒæ—¶ ä¸º python2 ä¸ Python3 æ·»åŠ  type hintã€‚è¿™æ—¶å€™ä½ éœ€è¦ç¼–å†™ä¸€å®šçš„é€»è¾‘å¤„ç†è¿™ä¸ªäº‹æƒ…ï¼š



```python
from __future__ import unicode_literals

class A(object):
    def __repr__(self) -> str:
        res = 'A({})'.format(self.full_name)
        if sys.version_info > (3, 0):
            # noinspection PyTypeChecker
            return res
        # noinspection PyTypeChecker
        return res.encode('utf-8')
```



è€Œè¿™æ—¶å€™ä½ ä¸ºäº†è®© IDE æ¥å—è¿™ç§å†™æ³•ï¼Œä½ è¿˜è¦æ·»åŠ ä¸€äº›æ³¨é‡Šã€‚ç°åœ¨è¿™ä¸ªä»£ç çš„å¯è¯»æ€§å˜å¾—éå¸¸çš„å·®ï¼Œè€Œä¸”å…³é”®æ˜¯ä½ ç°åœ¨åœ¨è¿è¡Œæ—¶è¿›è¡Œäº†ç±»å‹æ£€æŸ¥ã€‚



!!!! 2. Multiple return types

å‡è®¾ä½ ç°åœ¨è¦ç¼–å†™ä¸€ä¸ªå‡½æ•°å¯èƒ½è¿”å› ` str` æˆ–è€… ` int ` ä¸­çš„ä¸€ä¸ªï¼š

```python
def magic(i: Union[str, int]) -> Union[str, int]:
    return i * 2
```

ä½†æ˜¯ç°åœ¨ä½ æƒ³å¼¹é›¨å¢åŠ äº†ä¸¤ç§å¯èƒ½ï¼Œä½†æ˜¯ Python è§£é‡Šå™¨å¹¶ä¸çŸ¥é“å“ªä¸ªå¯¹åº”å“ªä¸€ä¸ªã€‚è¿™æ—¶å€™ä½ å¯èƒ½è¦åœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™å†™ä¸€ä¸ª assert è¯­å¥ï¼š

```python
def other_func() -> int:
    result = magic(2)
    assert isinstance(result, int)
    return result
```

è¿™ç§ä¸ä¾¿å¯èƒ½ä¼šè®©ä¸€äº›äººä¸ºäº†é¿å…è¿™äº›éº»çƒ¦è€Œå°†å‡½æ•°çš„è¿”å›ç±»å‹è®¾ç½®ä¸º Anyã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚ type hint system æ”¯æŒä½ å®šä¹‰ overloads å‡½æ•°ã€‚

```python
from typing import overload

@overload
def magic(i: int) -> int:
    pass

@overload
def magic(i: str) -> str:
    pass

def magic(i: Union[int, str]) -> Union[int, str]:
    return i * 2

def other_func() -> int:
    result = magic(2)
    return result
```

è¿™æ—¶å€™ä½ çš„ lint å·¥å…·å¯èƒ½ä¼šæŠ¥é”™æ²¡æœ‰è¿™ä¸ªå‡½æ•°ï¼Œè¿™æ—¶å€™ä½ éœ€è¦æ·»åŠ  ` # pylint: disable=function-redefined` ã€‚

!!!! 3. Type lookup

å‡è®¾ä½ ç°åœ¨æœ‰ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»å…è®¸å°†åŒ…å«çš„æ•°æ®è¡¨ç°ä¸ºå¤šç§ç±»å‹ï¼Œæˆ–è€…æ‹¥æœ‰å¤šç§ç±»å‹çš„æ•°æ®ã€‚ä½ æƒ³è®©ç”¨æˆ·å¿«é€Ÿçš„å®šä½åˆ°æŸä¸€ä¸ªéœ€è¦çš„ç±»å‹ï¼š

```python
class A(object):
    def float(self):
            # type: () -> float
           return 1.0
```

ç°åœ¨ä½ ç”¨ linter å·¥å…·çš„æ—¶å€™ä¼šå‘ç°ï¼š

```bash
test.py:3: error: Invalid type "test.A.float"
```

ä½ è¿™æ—¶å€™å¯èƒ½ä¼šç–‘é—®ï¼Œè¿™æ˜¯ä»€ä¹ˆç©æ„å„¿ï¼Ÿï¼Ÿ æˆ‘å°†è¿”å›å€¼å®šä¹‰ä¸ºäº† ` float` è€Œä¸æ˜¯ ` test.A.float`ã€‚è¿™æ˜¯å› ä¸º type hint system æ˜¯å‘å¤–ä¸€å±‚ä¸€å±‚çš„æŸ¥æ‰¾éœ€è¦çš„ç±»å‹çš„ã€‚ä¸Šè¿°ä¾‹å­ä¸­é¦–å…ˆæœç´¢ class A ä¸­çš„ floatã€‚

è§£å†³æ–¹æ³•å°±æ˜¯æ˜ç¡®çš„æŒ‡å®š ` builtin` çš„ ` float` ç±»å‹ï¼š

```python
if typing.TYPE_CHECKING:
    import builtins

class A(object):
    def float(self):
            # type: () -> builtins.float
           return 1.0
```

è¿™ç§æƒ…å†µä¸‹éœ€è¦å¯¼å…¥ builtins ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›è¿è¡Œæ—¶é”™è¯¯ã€‚å¦‚æœä½ ä¸æƒ³åœ¨è¿è¡Œæ—¶å¯¼å…¥ builtinsï¼Œå¯ä»¥æŒ‡å®š `typing.TYPE_CHECKING` å˜é‡ï¼Œè¿™æ ·åªæœ‰åœ¨ linter æµ‹è¯•ä»£ç æ—¶æ‰ä¼šå¯¼å…¥ builtinsã€‚

!!!! 4. Contravariant argument

ä»¥ä¸‹é¢è¿™ä¸ª case ä¸ºä¾‹å­ã€‚ä½ å®šä¹‰äº†ä¸€ä¸ªåŒ…å«åŸºæœ¬æ“ä½œçš„æŠ½è±¡ç±»ã€‚ç„¶åä½ é€šè¿‡ä¸åŒçš„ç±»æ¥æ§åˆ¶ä¸åŒçš„ç±»å‹è¾“å…¥ï¼š

```python
from abc import ABCMeta, abstractmethod
from typing import Union

class A(metaclass=ABCMeta):
    @abstractmethod
    def func(self, key):  # type: (Union[int, str]) -> str
        raise NotImplementedError

class B(A):
    def func(self, key):  # type: (int) -> str
        return str(key)

class C(A):
    def func(self, key):  # type: (str) -> str
        return key
```

è¿™æ ·çœ‹èµ·æ¥è®¾è®¡ä¸é”™ï¼Œä½†æ˜¯å½“ä½ è¿è¡Œ type linter æ—¶ï¼Œä½ ä¼šå‘ç°ï¼š

```bash
test.py:12: error: Argument 1 of "func" incompatible with supertype "A"
test.py:17: error: Argument 1 of "func" incompatible with supertype "A"
```

å‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ï¼Œç±»çš„å‚æ•°æ˜¯é€†å˜å¾—ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ çš„å­—ç±»å¿…é¡»èƒ½å¤Ÿå¤„ç†çˆ¶ç±»ä¸­æŒ‡å®šçš„æ‰€æœ‰ç±»å‹ã€‚å³ä½¿åœ¨å‡½æ•°ä¸­ï¼Œä½ ä¹Ÿåªèƒ½è¿›è¡Œæ‰©å±•è€Œä¸èƒ½è¿›è¡Œé™åˆ¶ï¼š

```python
from abc import ABCMeta, abstractmethod
from typing import Union

class A(metaclass=ABCMeta):
    @abstractmethod
    def func(self, key):  # type: (Union[int, str]) -> str
        raise NotImplementedError

class B(A):
    def func(self, key):  # type: (Union[int, str, bool]) -> str
        return str(key)

class C(A):
    def func(self, key):  # type: (Union[int, str, List]) -> str
        return key
```

!!!! 5. å…¼å®¹æ€§

çœ‹çœ‹ä¸‹é¢çš„ä»£ç çœ‹èƒ½å¦æ‰¾å‡ºé”™è¯¯ï¼š

```python
class A:
    @classmethod
    def magic(cls, a: int) -> 'A':
        return cls()

class B(A):
    @classmethod
    def magic(cls, a: int, b: bool) -> 'B':
        return cls()
```

å¦‚æœæ²¡æœ‰æ‰¾å‡ºæ¥ï¼Œé‚£ä¹ˆæƒ³æƒ³è¿è¡Œä»¥ä¸‹ä»£ç çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆï¼š

```python
from typing import List, Type

elements : List[Type[A]] = [A, B]
print( [e.magic(1) for e in elements])
```

å½“ä½ è¿è¡Œæ—¶ä¼šå¾—åˆ°ä»¥ä¸‹é”™è¯¯ï¼š

```python
    print( [e.magic(1) for e in elements])
TypeError: magic() missing 1 required positional argument: 'b'
```

è¿™æ˜¯å› ä¸º B ç»§æ‰¿äº† Aï¼ŒB åº”è¯¥åœ¨ A çš„åŸºç¡€ä¸Šæ‰©å±•ã€‚è€Œä¸Šé¢çš„ä»£ç ä½¿å¾— `B.magic()` å¾—æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œæ‰€ä»¥ B æ²¡æœ‰ æ‰©å±• A è€Œæ˜¯ä¿®æ”¹äº† Aã€‚è¿™æ—¶å€™ç±»å‹æ£€æŸ¥å°±ä¼šæŠ¥é”™ï¼š

```bash
test.py:9: error: Signature of "magic" incompatible with supertype "A"
```

ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•æ˜¯è®© B çš„magic æ–¹æ³•ä¹Ÿèƒ½åªæ¥å—ä¸€ä¸ªå‚æ•°ã€‚

```python
class A:
    def __init__(self, a: int) -> None:
        pass

class B(A):
    def __init__(self, a: int, b: bool) -> None:
        super().__init__(a)
```

ä½ è§‰å¾—ä¸Šé¢çš„ä»£ç ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæ³¨æ„ä»…ä»…æ˜¯å°†ç±»æ–¹æ³•å˜æˆäº†æ„é€ æ–¹æ³•ã€‚è¿™æ—¶å€™å°è„šæœ¬ä¹Ÿéœ€è¦ç¨å¾®æ”¹ä¸€ä¸‹ï¼š

```python
from typing import List, Type

elements : List[Type[A]]= [A, B]
print( [e(1) for e in elements])
```

ç°åœ¨æŠ¥é”™åŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ä» magic æ–¹æ³•å˜æˆäº† `__init__()` æ–¹æ³•:

```bash
		print( [e(1) for e in elements])
TypeError: __init__() missing 1 required positional argument: 'b'
```

ä½†æ˜¯åƒ mypy è¿™æ ·çš„ linter å¹¶ä¸ä¼šæŠ¥é”™ï¼Œå³ä½¿è¿™ä¸ªä»£ç è¿è¡Œæ—¶ä¼šå‡ºé”™è¯¯ã€‚mypy çš„åˆ›å§‹äººè¯´è¿™ç§ä¸åŒ¹é…çš„æƒ…å†µå¤ªå¸¸è§ï¼Œæ‰€ä»¥å°±ä¸è€ƒè™‘ `__init__` å’Œ `__new__` æ–¹æ³•ã€‚

!! å½“ä½ ç¢°å£æ—¶

æ‰€ä»¥æˆ‘ä»¬çš„ç»“è®ºæ˜¯ï¼Œå½“ä½ ä½¿ç”¨ type hint çš„æ—¶å€™éœ€è¦å°å¿ƒï¼Œå› ä¸ºæœ‰å¾ˆå¤šè¯¡å¼‚çš„é—®é¢˜ã€‚

å°±åƒä¸‹é¢è¿™ä¸ª tweet çš„æè¿°ä¸€æ ·ï¼š

[img[https://www.bernat.tech/content/images/2018/05/david.png]]

æ³¨æ„å½“ä½ ä½¿ç”¨æ—¶æœ‰å¾ˆå¤šå·¥å…·å¯ä»¥å¸®åŠ©ä½ ï¼š

* ä½¿ç”¨ `reveal_type` æ¥æŸ¥çœ‹æ¨å¯¼å‡ºçš„ç±»å‹ï¼š <div>

```python
a = [4]
reveal_type(a)         # -> error: Revealed type is 'builtins.list[builtins.int*]'
```

</div>

* ä½¿ç”¨ `cast` æ¥å¼ºåˆ¶è½¬æ¢ç±»å‹ <div>

```python
from typing import List, cast
a = [4]
b = cast(List[int], a) # passes fine
c = cast(List[str], a) # type: List[str] # passes fine (no runtime check)
reveal_type(c)         # -> error: Revealed type is 'builtins.list[builtins.str]'
```

</div>


* ä½¿ç”¨ type ignore marker æ¥ç¦ç”¨ error <div>
  
```python
x = confusing_function() # type: ignore # see mypy/issues/1167
```

</div>

* å»[[ç¤¾åŒº|https://gitter.im/python/typing]]æé—® <div>

</div>


!! å·¥å…·

è¿™é‡Œæ˜¯å…³äº type hint system çš„è¯¦ç»†å·¥å…·åˆ—è¡¨ã€‚


!!! type checkers


ä½¿ç”¨è¿™äº›å·¥å…·æ¥æ£€æŸ¥åº“æˆ–è€…åº”ç”¨ç¨‹åºå†…éƒ¨çš„ç±»å‹å®‰å…¨ï¼š

# [[mypy - Python|http://mypy-lang.org/]]

# [[pyre - Facebook|https://github.com/facebook/pyre-check]]ï¼Œä»…ä»…æ”¯æŒ python3 ä½†æ˜¯æ¯” mypy å¿«ã€‚
# [[pytype - Google|https://github.com/google/pytype]]ã€‚



!!! type annoation generators

å½“ä½ æƒ³è¦ä¸ºå·²ç»å­˜åœ¨çš„åº“æˆ–è€…ç¨‹åºæ·»åŠ ç±»å‹æ³¨é‡Šï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·æ¥è‡ªåŠ¨æ·»åŠ ã€‚

# ` mypy stubgen ` å‘½ä»¤è¡Œå·¥å…·ã€‚[[å‚è€ƒè¿™é‡Œ|https://github.com/python/mypy/blob/master/mypy/stubgen.py]]ã€‚

# [[Pyannotate - Dropbox|https://github.com/dropbox/pyannotate]] , æ ¹æ® tests ç”Ÿæˆç±»å‹ä¿¡æ¯ã€‚
# [[monkeytype - Instagram|https://github.com/Instagram/MonkeyType]]

!!! Runtime code evaluator

ä½¿ç”¨è¿™äº›å·¥å…·æ¥åˆ¤æ–­è¿è¡Œæ—¶ä¼ é€’çš„å‚æ•°ç±»å‹æ˜¯å¦æ­£ç¡®ï¼š

# [[pydantic|https://github.com/samuelcolvin/pydantic]]
# [[enforce|https://github.com/RussBaz/enforce]]
# [[pytypes|https://github.com/Stewori/pytypes]]

!!! Documentation enrichment - ç»“åˆ docstrings å’Œ type hints

åœ¨ä¹‹å‰å·²ç»è¯´åˆ°ï¼Œåœ¨ type hint system å‡ºæ¥ä¹‹å‰ï¼Œå·²ç»æœ‰äººåœ¨ docstring ä¸­åŠ å…¥ ç±»å‹ä¿¡æ¯ã€‚å› ä¸ºç±»å‹ä¿¡æ¯æ˜¯è¿™ä¸ªåº“çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥äººä»¬å½“ç„¶æƒ³è¦åœ¨æ–‡æ¡£ä¸­ä½“ç°å‡ºæ¥ã€‚ç°åœ¨é—®é¢˜æ˜¯å¦‚æœä½ ä¸é€‰æ‹©å°†ç±»å‹ä¿¡æ¯æ·»åŠ åˆ° docstring è€Œæ˜¯ä½¿ç”¨ ç±»å‹æ³¨è§£çš„æ–¹å¼ï¼Œé‚£ä½ æ€ä¹ˆæ‰èƒ½åœ¨æ–‡æ¡£ä¸­ä½“ç°å‡ºæ¥å‚æ•°çš„ç±»å‹å‘¢ï¼Ÿ

ç­”æ¡ˆä¼šå› ä¸ºä½ é€‰æ‹©çš„æ–‡æ¡£ç”Ÿæˆå·¥å…·çš„ä¸åŒè€Œä¸åŒã€‚è¿™é‡Œæˆ‘ä»¬ä»…ä»…æ¢è®¨ä¸€ä¸‹æœ€æµè¡Œçš„æ–‡æ¡£å·¥å…·ï¼šSphinx å’Œ HTMLã€‚

å¦‚æœåŒæ—¶åœ¨ä½¿ç”¨ç±»å‹æ³¨è§£å’Œ docstring æ·»åŠ ç±»å‹ä¿¡æ¯ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¼šäº§ç”Ÿå†²çªã€‚ä½ å¯ä»¥è®©ä¸€ä¸ªäººå»æ›´æ–°å…¶ä¸­ä¸€ç§è€Œä¸å¯èƒ½åœ¨æ›´æ–°ä»£ç çš„æ—¶å€™åŒæ—¶å»æ›´æ–°è¿™ä¸¤ç§ä¿¡æ¯ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬å°†æ‰€æœ‰çš„ç±»å‹ä¿¡æ¯éƒ½æ·»åŠ åˆ°ç±»å‹æ³¨è§£ä¸­ã€‚ç°åœ¨æˆ‘ä»¬åªéœ€è¦åœ¨æ„å»ºæ–‡æ¡£çš„æ—¶å€™ä»ç±»å‹æ³¨è§£ä¸­è·å–ç±»å‹ä¿¡æ¯å¹¶ä¸”å°†ç±»å‹ä¿¡æ¯æ·»åŠ åˆ°æ–‡æ¡£ã€‚


åœ¨ Sphinx ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªæ’ä»¶è¾¾åˆ°è¿™ä¸ªæ•ˆæœã€‚[[agronholm/sphinx-autodoc-typehints|https://github.com/agronholm/sphinx-autodoc-typehints]]ï¼Œ è¿™ä¸ªæ’ä»¶åšäº†ä¸¤ä»¶äº‹æƒ…ï¼š

* é¦–å…ˆï¼Œå®ƒä¼šè·å–æ‰€æœ‰éœ€è¦å†™å…¥æ–‡æ¡£çš„ å˜é‡/å‡½æ•°çš„ç±»å‹ä¿¡æ¯ã€‚
* ç„¶åï¼Œä»–å°†Python ç±»å‹ä¿¡æ¯è½¬æ¢åˆ°ä¸€ä¸ª docstring çš„è¡¨ç°å½¢å¼ã€‚
* æœ€åï¼Œå°†è¿™äº›ä¿¡æ¯æ·»åŠ åˆ° docstring å¹¶ç”Ÿæˆæ–‡æ¡£ã€‚

ä¾‹å¦‚ï¼Œ` Any ` å¯¹åº”ç€

```bash
py:data: `~typing.Any`
```

å¯¹äºå¤åˆç±»å‹å¯èƒ½ä¼šç¨å¾®æœ‰ç‚¹å¤æ‚ã€‚ä¾‹å¦‚` Mapping[str, bool]` åº”è¯¥è½¬æ¢ä¸º

```bash
:class:`~typing.Mapping`\\[:class:`str`, :class:`bool`]`
```

è¿™é‡Œçš„æ­£ç¡®è½¬æ¢æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œå› ä¸ºè¿™æ ·è½¬æ¢äº† `intershpinx` æ’ä»¶æ‰èƒ½æ­£ç¡®çš„å·¥ä½œã€‚

è¦ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œå°±éœ€è¦ä½¿ç”¨ pip å®‰è£…ï¼š

```bash
pip install sphinx-autodoc-types>=2.1.1
```

ç„¶ååœ¨ `conf.py` ä¸­é…ç½®æ’ä»¶ï¼š

```python
! conf.py
extensions = ['sphinx_autodoc_typehints']
```

!! Conclusion

åœ¨è¿™ç¯‡è¶…é•¿çš„åšæ–‡æœ€åï¼Œä½ å¯èƒ½ä¼šé—®ï¼šåˆ°åº•æ˜¯ä¸æ˜¯å€¼å¾—ä½¿ç”¨ type hint æˆ–è€…è¯´æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™è¯¥ç”¨ type hintã€‚æˆ‘è®¤ä¸ºtype hint å°±åƒ unittest ä¸€æ ·ï¼Œæ˜¯ä¸€ç§æ£€éªŒä»£ç çš„æ–¹å¼ã€‚

å› æ­¤ï¼Œç»“è®ºæ˜¯ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ type hintã€‚æ— è®ºæ˜¯å¦è¦å†™ unittestã€‚

è®°ä½ï¼Œå°±åƒ unittest ä¸€æ ·ï¼Œè¿™å¯èƒ½ä¼šè®©ä½ çš„ä»£ç å¤šå¢åŠ å‡ è¡Œã€‚ä½†æ˜¯è¿™æ ·åœ¨æ‰€æœ‰çš„ä¿®æ”¹ä»¥åï¼Œè¿™äº›ä»£ç ä¼šè‡ªåŠ¨æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ã€‚



!! ä¸ºä½•è¦ä½¿ç”¨ python Keyword arguments

* ä½¿ç”¨ keywords arguments å¯ä»¥è®©æˆ‘ä»¬è®¾ç½® default å‚æ•°ã€‚
* ä½¿ç”¨ keywords arguments å¯ä»¥è®©æˆ‘ä»¬ä¸åœ¨æ„å‚æ•°çš„é¡ºåºã€‚
* ä½¿ç”¨ keywords arguments å¯ä»¥ä½¿ä»£ç æ›´æ¸…æ™°


!! Reference

* [[PEP484|https://www.python.org/dev/peps/pep-0484/]]

* [[The state of type hints in Python|https://www.bernat.tech/the-state-of-type-hints-in-python/]]