caption: ç¼–è¾‘æ–‡æœ¬æ–‡ä»¶ sed
created: 20190805161554034
creator: liyzcj
modified: 20200619034138876
modifier: liyzcj
tags: StandardUnixPrograms TextProcessTools
title: sed æ–‡æœ¬å¤„ç†
type: text/vnd.tiddlywiki

!sed å‘½ä»¤

sed æ˜¯ä¸€ç§æµç¼–è¾‘å™¨, å¯ä»¥ç”¨æ¥è‡ªåŠ¨ç¼–è¾‘ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶, ç®€åŒ–å¯¹æ–‡ä»¶çš„åå¤æ“ä½œ.
---


> [[Official Documentation|https://www.gnu.org/software/sed/manual/sed.html]]

!! Usage


```bash
s/regexp/replacement/flags
```

```bash
sed -i "s/to_be_replace/new_value/g"
```

æˆ–è€…ä½¿ç”¨ `#` ä½œä¸ºåˆ†éš”ç¬¦

```bash
sed -i "s#to_be_replace#new_value#g"
```

!! flags

`g`: replace all matches, not just first



!! å¸¸ç”¨æ“ä½œ

---

è‡ªåŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶:

```bash
sed -i "s/\(é…ç½®é¡¹=\)\S*/\1å€¼/" é…ç½®æ–‡ä»¶

# "-i" æ˜¯ç›´æ¥ä¿®æ”¹æ–‡ä»¶
# "s/1/2"    sæ˜¯æ›¿æ¢ï¼Œç”¨2 æ›¿æ¢1
# \( \)  ä½¿ç”¨è½¬ä¹‰æ‹¬å·åŒ…å«ä¸å˜é¡¹ï¼Œ ç„¶ååœ¨æ›¿æ¢å€¼é‡Œç”¨ \1 è°ƒç”¨
# "\S*" ç”¨æ¥åŒ¹é…éç©ºæ ¼å­—ç¬¦
```

å¦‚æœéœ€è¦æ›¿æ¢çš„æ–‡æœ¬ä¸­åŒ…å« `/` ,å°±ä¸èƒ½ä½¿ç”¨ `/` åˆ†éš”å­—æ®µã€‚åº”ä½¿ç”¨ `#`ã€‚

```bash
sed -i "s#\(é…ç½®é¡¹=\)\S*#\1æ›¿æ¢å€¼#g" file
# å¦‚æœæ›¿æ¢å€¼æˆ–é…ç½®é¡¹é‡Œæœ‰å¼•å·ï¼Œåº”è¯¥åœ¨å¤–é¢åŠ ä¸€ä¸ªå¼•å·ï¼Œå¼•å·é‡Œé¢å†ä½¿ç”¨åæ–œæ è½¬ä¹‰å¼•å·ã€‚
sed -i "s#\(é…ç½®é¡¹=\)\S*#"\1\"test\""#g" file 
```

!!! åˆ é™¤æŸè¡Œ

> æ³¨æ„ï¼Œä¸€å®šè¦ä½¿ç”¨ `'` è€Œä¸æ˜¯åŒå¼•å· `"`.

åˆ é™¤ç¬¬ N è¡Œï¼š

```bash
sed -i 'Nd' file
```

åˆ é™¤æœ€åä¸€è¡Œï¼š

```bash
sed -i '$d' file
```

åˆ é™¤ 5-9 è¡Œï¼š

```bash
sed -i '5,9d' file
```

åˆ é™¤å¤šè¡Œï¼š

```bash
sed -i '1d;5d;$d;' file
```

åˆ é™¤ 3-4 ä¹‹å¤–çš„è¡Œï¼š

```bash
sed -i '3,4!d' file
```

åˆ é™¤ç©ºè¡Œ, `//`ä¹‹é—´åŠ ä¸Š regexï¼š

```bash
# sed '/^$/d' sed-demo.txt
```


---

æ›¿æ¢ ssh é»˜è®¤ç›‘å¬åœ°å€ï¼š

```bash
sed -i "s#\\#\(Port\) 22\S*#\1 8922#g" /etc/ssh/sshd_config
```

> æ³¨æ„æ–‡æœ¬å†…çš„ `#` éœ€è¦è½¬ä¹‰ `\\#`.

---

!! Macos sed

Macos ä¸Šçš„ `sed` å’Œ linux ä¸Šçš„è¡¨ç°ä¸ä¸€è‡´ï¼Œ`-i`å‚æ•°åé¢éœ€è¦è·Ÿä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¤‡ä»½æ–‡ä»¶çš„åç¼€ï¼Œç¬¬äºŒä¸ªæ‰æ˜¯ä¸Šé¢çš„å­—ä¸²ã€‚

```bash
sed -i "å¤‡ä»½åç¼€" "s#\(é…ç½®é¡¹=\)\S*#"\1\"test\""#g" file 
```

> å¦‚æœä¸éœ€è¦å¤‡ä»½ï¼Œå¯ä»¥ç•™ç©ºã€‚ ğŸ’¡`\S` è½¬ä¹‰è²Œä¼¼ä¹Ÿä¸å¯ç”¨ã€‚

''æ¨èåœ¨ Macos ä¸Šä¹Ÿé€‚ç”¨ gnu-sed'', å®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š

```bash
brew install gnu-sed
export PATH="/usr/local/opt/gnu-sed/libexec/gnubin:$PATH"
```